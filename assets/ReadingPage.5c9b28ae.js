import{Q as f,a as I}from"./QCard.e4543373.js";import{f as x,Q as F}from"./fisherYates.a2d59537.js";import{Q as k}from"./QSeparator.ba6a8f71.js";import{_ as T,r as o,o as p,c as b,w as c,ag as y,e as a,b as s,t as h,i as V,ai as D,ah as O,h as _,aj as q,ak as g,Q as m}from"./index.84a03356.js";import{Q as B}from"./QCardActions.2fccd58c.js";import{Q as R}from"./QDialog.3ff4f6d7.js";import{Q as j}from"./QPage.45ee8f60.js";import{C as S}from"./ClosePopup.aebf0a38.js";import"./use-dark.28ca17e4.js";import"./option-sizes.005a78de.js";import"./use-form.39c6ddc7.js";import"./use-prevent-scroll.a70b7d0f.js";import"./focus-manager.d6507951.js";const A={name:"StructurePage",setup(){const t=o(0),i=o(!0),l=o(!1),e=x([0,1,2,3]),r=o(e);return{isFirstIndex:i,isLastIndex:l,questions:o([]),ansopts:o([]),shuffledOptions:r,confirm:o(!1),maxpage:o(0),current:t}},data(){const t=o([]),i=o([]);return{minutes:o(""),seconds:o(""),response:t,answers:i}},computed:{},created(){},mounted(){const t=this.$route.params.id;this.$store.dispatch("exam/getReadingQuestions",t).then(i=>{const l=x(i.data.exam.questions),e=x(l);this.questions=e,console.log(this.questions[0].answerOptions),this.maxpage=this.questions.length-1}).catch(i=>{console.log(i)}),this.startTimer(60*30)},beforeUnmount(){clearInterval(this.intervalId)},methods:{startTimer(t,i){let l=t;this.intervalId=setInterval(()=>{this.minutes=parseInt(l/60,10),this.seconds=parseInt(l%60,10),this.minutes=this.minutes<10?"0"+this.minutes:this.minutes,this.seconds=this.seconds<10?"0"+this.seconds:this.seconds,--l<0&&(this.$q.notify({message:"Time out, proceed to next section",color:"secondary"}),this.onFinish(),clearInterval(this.intervalId))},1e3)},nextQuestion(){if(this.current===this.maxpage)return this.isLastIndex=!0,this.$q.notify({message:"You are already at the last page"});this.current++,this.isFirstIndex=!1},previousQuestion(){if(this.current>0)this.current--;else return this.$q.notify({message:"You are already at the first page"})},onFinishConfirm(){this.confirm=!0},async onFinish(){try{this.$q.loading.show({message:"Submitting answers"});const t=this.$route.params.id,i=this.questions.map(n=>n._id),l=this.questions.map(n=>n.correctAnswer),e=this.response.map(n=>n);let r=null,u=0;const d=[];for(let n=0;n<i.length;n++){const C=await i[n],Q=await e[n]?e[n]:"";e[n]===l[n]?(r={userId:this.$store.state.auth.user.id,questionId:C,examId:t,answerChoice:Q,isCorrect:!0},u++,d.push(r)):(r={userId:this.$store.state.auth.user.id,questionId:C,examId:t,answerChoice:Q,isCorrect:!1},d.push(r))}const v=new Date().toISOString().slice(0,10),w={userId:this.$store.state.auth.user.id,examId:t,readingRaw:u,date:v,responses:d};await this.$store.dispatch("exam/saveResult",w),await this.$router.push({name:"finishpage",params:{id:this.$route.params.id}})}catch(t){this.$q.notify({message:t})}finally{this.$q.loading.hide()}},onChange(t){console.log(t.target.value)}}},N={key:0,class:"row justify-center"},P={class:"full-width"},U={class:"text-h6"},Y={class:"row justify-between"},E={class:"self-end"},L={align:"left"},H={class:"self-start"},K={align:"right"},M={class:"text-justify"},X=a("div",{class:"subtitle"}," Question : ",-1),z={class:"column self-center"},G={class:"row"},J={key:1},W=V(" NO DATA "),Z=a("span",null,"Are you sure?",-1);function $(t,i,l,e,r,u){return p(),b(j,{padding:"",class:"column"},{default:c(()=>[e.questions.length>0?(p(),y("div",N,[a("div",P,[s(I,{class:"full-width"},{default:c(()=>[s(f,null,{default:c(()=>[a("div",U,h(e.questions[e.current].questionType),1),a("div",Y,[a("div",E,[a("span",L," Question "+h(e.current+1)+" of "+h(e.maxpage+1),1)]),a("div",H,[a("span",K,"Test Duration: "+h(r.minutes)+":"+h(r.seconds)+"s",1)])])]),_:1}),s(f,null,{default:c(()=>[a("div",M,h(e.questions[e.current].paragraphs),1)]),_:1}),s(f,null,{default:c(()=>[X,V(" "+h(e.questions[e.current].question),1)]),_:1}),(p(!0),y(D,null,O(e.shuffledOptions,(d,v)=>(p(),b(f,{key:v},{default:c(()=>[s(F,{modelValue:r.response[e.current],"onUpdate:modelValue":i[0]||(i[0]=w=>r.response[e.current]=w),val:e.questions[e.current].answerOptions[d],label:e.questions[e.current].answerOptions[d]},null,8,["modelValue","val","label"]),s(k,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128))]),_:1})]),a("div",z,[a("div",G,[_(s(m,{color:"primary",icon:"arrow_left",label:"PREVIOUS",onClick:g(u.previousQuestion,["prevent"])},null,8,["onClick"]),[[q,e.current>0]]),_(s(m,{color:"primary","icon-right":"arrow_right",label:"NEXT",onClick:g(u.nextQuestion,["prevent"])},null,8,["onClick"]),[[q,e.current!==e.maxpage]]),s(k,{spaced:"",inset:"",vertical:"",dark:""}),_(s(m,{color:"accent",icon:"check",label:"Finish",onClick:g(u.onFinishConfirm,["prevent"])},null,8,["onClick"]),[[q,e.current===e.maxpage]])])])])):(p(),y("div",J,[W,s(m,{flat:"",dense:"",color:"primary",label:"Back Home",to:"/home"})])),s(R,{modelValue:e.confirm,"onUpdate:modelValue":i[1]||(i[1]=d=>e.confirm=d),persistent:""},{default:c(()=>[s(I,null,{default:c(()=>[s(f,{class:"row items-center"},{default:c(()=>[Z]),_:1}),s(B,{align:"right"},{default:c(()=>[_(s(m,{flat:"",label:"Cancel",color:"primary"},null,512),[[S]]),_(s(m,{flat:"",label:"Yes",color:"primary",onClick:g(u.onFinish,["prevent"])},null,8,["onClick"]),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var me=T(A,[["render",$]]);export{me as default};
