import{Q as _,a as Q}from"./QCard.e4543373.js";import{f as w,Q as S}from"./fisherYates.a2d59537.js";import{Q as I}from"./QSeparator.ba6a8f71.js";import{_ as V,r as o,o as m,c as k,w as d,e as r,ag as x,b as n,t as h,i as b,ai as T,ah as D,h as f,aj as q,ak as v,Q as p}from"./index.84a03356.js";import{Q as O}from"./QCardActions.2fccd58c.js";import{Q as B}from"./QDialog.3ff4f6d7.js";import{Q as N}from"./QPage.45ee8f60.js";import{C as F}from"./ClosePopup.aebf0a38.js";import"./use-dark.28ca17e4.js";import"./option-sizes.005a78de.js";import"./use-form.39c6ddc7.js";import"./use-prevent-scroll.a70b7d0f.js";import"./focus-manager.d6507951.js";const P={name:"StructurePage",setup(){const s=o(0),t=o(!0),a=o(!1),e=w([0,1,2,3]),l=o(e);return{isFirstIndex:t,isLastIndex:a,questions:o([]),ansopts:o([]),shuffledOptions:l,confirm:o(!1),maxpage:o(0),current:s}},data(){const s=o([]),t=o([]);return{response:s,intervalId:0,minutes:o(""),seconds:o(""),answers:t}},computed:{},created(){},mounted(){const s=this.$route.params.id;this.$store.dispatch("exam/getStructureQuestions",s).then(t=>{const a=w(t.data.exam.questions,!0),e=w(a,!0);this.questions=e,console.log(this.questions[0].answerOptions),this.maxpage=this.questions.length-1}).catch(t=>{console.log(t)}),this.startTimer(60*20)},beforeUnmount(){clearInterval(this.intervalId)},methods:{startTimer(s,t){let a=s;this.intervalId=setInterval(()=>{this.minutes=parseInt(a/60,10),this.seconds=parseInt(a%60,10),this.minutes=this.minutes<10?"0"+this.minutes:this.minutes,this.seconds=this.seconds<10?"0"+this.seconds:this.seconds,--a<0&&(this.$q.notify({message:"Time out, proceed to next section",color:"secondary"}),this.onFinish(),clearInterval(this.intervalId))},1e3)},nextQuestion(){if(this.current===this.maxpage)return this.isLastIndex=!0,this.$q.notify({message:"You are already at the last page"});this.current++,this.isFirstIndex=!1},previousQuestion(){if(this.current>0)this.current--;else return this.$q.notify({message:"You are already at the first page"})},onFinishConfirm(){this.confirm=!0},async onFinish(){try{this.$q.loading.show({message:"Submitting answers"});const s=this.$route.params.id,t=this.questions.map(i=>i._id),a=this.questions.map(i=>i.correctAnswer),e=this.response.map(i=>i);let l=0,c=null;const u=[];for(let i=0;i<t.length;i++){const y=await t[i],C=await e[i]?e[i]:"";e[i]===a[i]?(c={userId:this.$store.state.auth.user.id,questionId:y,examId:s,answerChoice:C,isCorrect:!0},l++,u.push(c)):(c={userId:this.$store.state.auth.user.id,questionId:y,examId:s,answerChoice:C,isCorrect:!1},u.push(c))}const g={userId:this.$store.state.auth.user.id,examId:s,structureRaw:l,responses:u};console.log(g),console.log(u),await this.$store.dispatch("exam/saveResult",g),await this.$router.push({name:"readingpage",params:{id:this.$route.params.id}})}catch(s){this.$q.notify({message:s})}finally{this.$q.loading.hide()}},onChange(s){console.log(s.target.value)}}},j={class:"row justify-center"},A={key:0,class:"full-width"},R={class:"text-h6"},U={class:"row justify-between"},Y={class:"self-end"},E={align:"left"},L={class:"self-start"},K={align:"right"},M=r("div",{class:"subtitle"}," Question : ",-1),X={key:1},z={class:"column self-center"},G={class:"row"},H=r("span",null,"Finish section and proceed to next section?",-1);function J(s,t,a,e,l,c){return m(),k(N,{padding:"",class:"column"},{default:d(()=>[r("div",j,[e.questions.length>0?(m(),x("div",A,[n(Q,{class:"full-width"},{default:d(()=>[n(_,null,{default:d(()=>[r("div",R,h(e.questions[e.current].questionType),1),r("div",U,[r("div",Y,[r("span",E," Question "+h(e.current+1)+" of "+h(e.maxpage+1),1)]),r("div",L,[r("span",K,"Test Duration: "+h(l.minutes)+":"+h(l.seconds)+"s",1)])])]),_:1}),n(_,null,{default:d(()=>[M,b(" "+h(e.questions[e.current].question),1)]),_:1}),(m(!0),x(T,null,D(e.shuffledOptions,(u,g)=>(m(),k(_,{key:g},{default:d(()=>[n(S,{modelValue:l.response[e.current],"onUpdate:modelValue":t[0]||(t[0]=i=>l.response[e.current]=i),val:e.questions[e.current].answerOptions[u],label:e.questions[e.current].answerOptions[u]},null,8,["modelValue","val","label"]),n(I,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128))]),_:1})])):(m(),x("div",X," NO DATA ")),b(" "+h(l.response),1)]),r("div",z,[r("div",G,[f(n(p,{color:"primary",icon:"arrow_left",label:"PREVIOUS",onClick:v(c.previousQuestion,["prevent"])},null,8,["onClick"]),[[q,e.current>0]]),f(n(p,{color:"primary","icon-right":"arrow_right",label:"NEXT",onClick:v(c.nextQuestion,["prevent"])},null,8,["onClick"]),[[q,e.current!==e.maxpage]]),n(I,{spaced:"",inset:"",vertical:"",dark:""}),f(n(p,{color:"accent",icon:"check",label:"Finish",onClick:v(c.onFinishConfirm,["prevent"])},null,8,["onClick"]),[[q,e.current===e.maxpage]])])]),n(B,{modelValue:e.confirm,"onUpdate:modelValue":t[1]||(t[1]=u=>e.confirm=u),persistent:""},{default:d(()=>[n(Q,null,{default:d(()=>[n(_,{class:"row items-center"},{default:d(()=>[H]),_:1}),n(O,{align:"right"},{default:d(()=>[f(n(p,{flat:"",label:"Cancel",color:"primary"},null,512),[[F]]),f(n(p,{flat:"",label:"Yes",color:"primary",onClick:v(c.onFinish,["prevent"])},null,8,["onClick"]),[[F]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ue=V(P,[["render",J]]);export{ue as default};
