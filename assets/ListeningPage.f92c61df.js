import{Q as f,a as Q}from"./QCard.e4543373.js";import{_ as V,r as o,o as p,c as k,w as c,ag as y,e as r,b as i,t as m,i as F,Q as h,ak as _,ai as A,ah as S,h as g,aj as w}from"./index.84a03356.js";import{f as x,Q as T}from"./fisherYates.a2d59537.js";import{Q as I}from"./QSeparator.ba6a8f71.js";import{Q as B}from"./QCardActions.2fccd58c.js";import{Q as D}from"./QDialog.3ff4f6d7.js";import{Q as P}from"./QPage.45ee8f60.js";import{C as b}from"./ClosePopup.aebf0a38.js";import"./use-dark.28ca17e4.js";import"./option-sizes.005a78de.js";import"./use-form.39c6ddc7.js";import"./use-prevent-scroll.a70b7d0f.js";import"./focus-manager.d6507951.js";const L={name:"StructurePage",setup(){const t=o(0),s=o(!0),l=o(!1),e=x([0,1,2,3]),a=o(e);return{isFirstIndex:s,isLastIndex:l,questions:o([]),ansopts:o([]),shuffledOptions:a,confirm:o(!1),maxpage:o(0),current:t}},data(){const t=o([]),s=o([]);return{minutes:o(""),seconds:o(""),response:t,answers:s}},computed:{},created(){},mounted(){const t=this.$route.params.id;this.$store.dispatch("exam/getListeningQuestions",t).then(s=>{const l=x(s.data.exam.questions),e=x(l);this.questions=e,this.maxpage=this.questions.length-1}).catch(s=>{console.log(s),this.$q.notify({message:s})}),this.startTimer(60*20)},beforeUnmount(){clearInterval(this.intervalId)},methods:{startTimer(t,s){let l=t;this.intervalId=setInterval(()=>{this.minutes=parseInt(l/60,10),this.seconds=parseInt(l%60,10),this.minutes=this.minutes<10?"0"+this.minutes:this.minutes,this.seconds=this.seconds<10?"0"+this.seconds:this.seconds,--l<0&&(this.$q.notify({message:"Time out, proceed to next section",color:"secondary"}),this.onFinish(),clearInterval(this.intervalId))},1e3)},async playAudio(t){t&&new Audio(t).play()},nextQuestion(){if(this.current===this.maxpage)return this.isLastIndex=!0,this.$q.notify({message:"You are already at the last page"});this.current++,this.isFirstIndex=!1},previousQuestion(){if(this.current>0)this.current--;else return this.$q.notify({message:"You are already at the first page"})},onFinishConfirm(){this.confirm=!0},async onFinish(){try{this.$q.loading.show({message:"Submitting answers"});const t=this.$route.params.id,s=this.questions.map(n=>n._id),l=this.questions.map(n=>n.correctAnswer),e=this.response.map(n=>n);let a=null,u=0;const d=[];for(let n=0;n<s.length;n++){const q=await s[n],C=await e[n]?e[n]:"";e[n]===l[n]?(a={userId:this.$store.state.auth.user.id,questionId:q,examId:t,answerChoice:C,isCorrect:!0},u++,d.push(a)):(a={userId:this.$store.state.auth.user.id,questionId:q,examId:t,answerChoice:C,isCorrect:!1},d.push(a))}const v={userId:this.$store.state.auth.user.id,examId:t,listeningRaw:u,responses:d};await this.$store.dispatch("exam/saveResult",v),await this.$router.push({name:"structurepage",params:{id:this.$route.params.id}})}catch(t){this.$q.notify({message:t})}finally{this.$q.loading.hide()}},onChange(t){console.log(t.target.value)}}},N={key:0,class:"row justify-center"},O={class:"full-width"},U={class:"text-h6"},j={class:"row justify-between"},R={class:"self-end"},Y={align:"left"},E={class:"self-start"},H={align:"right"},K=r("div",{class:"subtitle"}," Question : ",-1),M={class:"column self-center"},X={class:"row"},z={key:1},G=F(" NO DATA "),J=r("span",null,"Finish section and proceed to next section?",-1);function W(t,s,l,e,a,u){return p(),k(P,{padding:"",class:"column"},{default:c(()=>[e.questions.length>0?(p(),y("div",N,[r("div",O,[i(Q,{class:"full-width"},{default:c(()=>[i(f,null,{default:c(()=>[r("div",U,m(e.questions[e.current].questionType),1),r("div",j,[r("div",R,[r("span",Y," Question "+m(e.current+1)+" of "+m(e.maxpage+1),1)]),r("div",E,[r("span",H,"Test Duration: "+m(a.minutes)+":"+m(a.seconds)+"s",1)])])]),_:1}),i(f,null,{default:c(()=>[K,F(" "+m(e.questions[e.current].question),1)]),_:1}),i(f,null,{default:c(()=>[i(h,{dense:"",flat:"",color:"primary",icon:"play_circle",label:"Play Audio",onClick:s[0]||(s[0]=_(d=>u.playAudio(e.questions[e.current].audioUrl),["prevent"]))})]),_:1}),(p(!0),y(A,null,S(e.shuffledOptions,(d,v)=>(p(),k(f,{key:v},{default:c(()=>[i(T,{modelValue:a.response[e.current],"onUpdate:modelValue":s[1]||(s[1]=n=>a.response[e.current]=n),val:e.questions[e.current].answerOptions[d],label:e.questions[e.current].answerOptions[d]},null,8,["modelValue","val","label"]),i(I,{spaced:"",inset:"",vertical:"",dark:""})]),_:2},1024))),128))]),_:1})]),r("div",M,[r("div",X,[g(i(h,{color:"primary",icon:"arrow_left",label:"PREVIOUS",onClick:_(u.previousQuestion,["prevent"])},null,8,["onClick"]),[[w,e.current>0]]),g(i(h,{color:"primary","icon-right":"arrow_right",label:"NEXT",onClick:_(u.nextQuestion,["prevent"])},null,8,["onClick"]),[[w,e.current!==e.maxpage]]),i(I,{spaced:"",inset:"",vertical:"",dark:""}),g(i(h,{color:"accent",icon:"check",label:"Finish",onClick:_(u.onFinishConfirm,["prevent"])},null,8,["onClick"]),[[w,e.current===e.maxpage]])])])])):(p(),y("div",z,[G,i(h,{flat:"",dense:"",color:"primary",label:"Back Home",to:"/home"})])),i(D,{modelValue:e.confirm,"onUpdate:modelValue":s[2]||(s[2]=d=>e.confirm=d),persistent:""},{default:c(()=>[i(Q,null,{default:c(()=>[i(f,{class:"row items-center"},{default:c(()=>[J]),_:1}),i(B,{align:"right"},{default:c(()=>[g(i(h,{flat:"",label:"Cancel",color:"primary"},null,512),[[b]]),g(i(h,{flat:"",label:"Yes",color:"primary",onClick:_(u.onFinish,["prevent"])},null,8,["onClick"]),[[b]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ue=V(L,[["render",W]]);export{ue as default};
